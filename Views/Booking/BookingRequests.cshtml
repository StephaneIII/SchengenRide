@model List<SamkørselApp.Controllers.BookingRequestViewModel>
@{
    ViewData["Title"] = "Booking Requests";
}

<div class="container mt-4">
    <h2>Booking Requests for Your Routes</h2>
    <p class="text-muted">Review and approve or reject booking requests from passengers.</p>

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }

    @{
        var pendingRequests = Model.Where(b => b.Status == "Pending").ToList();
        var otherRequests = Model.Where(b => b.Status != "Pending").ToList();
    }

    @if (pendingRequests.Count > 0)
    {
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="bi bi-clock-history"></i> Pending Requests (@pendingRequests.Count)
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Passenger</th>
                                <th>Route</th>
                                <th>Departure</th>
                                <th>Seats</th>
                                <th>Price</th>
                                <th>Requested On</th>
                                <th>Actions</th>
                                <th>Info</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var request in pendingRequests)
                            {
                                <tr>
                                    <td>
                                        <strong>@request.PassengerName</strong>
                                        <br><small class="text-muted">@request.PassengerEmail</small>
                                    </td>
                                    <td><strong>@request.StartCity</strong> → <strong>@request.EndCity</strong></td>
                                    <td>@request.Departure.ToString("dd MMM yyyy, HH:mm")</td>
                                    <td>@request.SeatsBooked</td>
                                    <td>€@request.PricePaid.ToString("F2")</td>
                                    <td>@request.BookingDate.ToString("dd MMM yyyy")</td>
                                    <td>
                                        <form asp-action="ApproveBooking" method="post" class="d-inline">
                                            <input type="hidden" name="bookingId" value="@request.BookingID" />
                                            <button type="submit" class="btn btn-success btn-sm">
                                                ✓ Approve
                                            </button>
                                        </form>
                                        <form asp-action="RejectBooking" method="post" class="d-inline">
                                            <input type="hidden" name="bookingId" value="@request.BookingID" />
                                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to reject this booking?');">
                                                ✗ Reject
                                            </button>
                                        </form>
                                    </td>
                                    <td>
                                        <a href="@Url.Action("RouteInfoView", "Route", new { id = request.RouteID })" class="btn btn-outline-info btn-sm">
                                            <i class="bi bi-info-circle"></i> Info
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> No pending booking requests at the moment.
        </div>
    }

    @if (otherRequests.Count > 0)
    {
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Previous Requests</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped mb-0">
                        <thead>
                            <tr>
                                <th>Booking #</th>
                                <th>Passenger</th>
                                <th>Route</th>
                                <th>Departure</th>
                                <th>Seats</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Info</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var request in otherRequests)
                            {
                                <tr>
                                    <td>#@request.BookingID</td>
                                    <td>@request.PassengerName</td>
                                    <td><strong>@request.StartCity</strong> → <strong>@request.EndCity</strong></td>
                                    <td>@request.Departure.ToString("dd MMM yyyy, HH:mm")</td>
                                    <td>@request.SeatsBooked</td>
                                    <td>€@request.PricePaid.ToString("F2")</td>
                                    <td>
                                        @if (request.Status == "Confirmed")
                                        {
                                            <span class="badge bg-success">@request.Status</span>
                                        }
                                        else if (request.Status == "Rejected")
                                        {
                                            <span class="badge bg-danger">@request.Status</span>
                                        }
                                        else if (request.Status == "Cancelled")
                                        {
                                            <span class="badge bg-secondary">@request.Status</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">@request.Status</span>
                                        }
                                    </td>
                                    <td>@request.BookingDate.ToString("dd MMM yyyy")</td>
                                    <td>
                                        <a href="@Url.Action("RouteInfoView", "Route", new { id = request.RouteID })" class="btn btn-outline-info btn-sm">
                                            <i class="bi bi-info-circle"></i> Info
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }

    <div class="mt-3">
        <a asp-controller="Route" asp-action="Index" class="btn btn-primary">Create New Route</a>
        <a asp-action="Index" class="btn btn-outline-secondary">Browse Routes</a>
    </div>
</div>
