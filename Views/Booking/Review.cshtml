@model SamkørselApp.Model.ReviewViewModel
@{
    ViewData["Title"] = "Write a Review";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-star-fill me-2" viewBox="0 0 16 16">
                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                        </svg>
                        Write a Review
                    </h4>
                </div>
                <div class="card-body">
                    @if (TempData["Error"] != null)
                    {
                        <div class="alert alert-danger">@TempData["Error"]</div>
                    }

                    @if (Model.HasExistingReview)
                    {
                        <div class="alert alert-info">
                            <strong>Review Already Submitted!</strong> You have already reviewed this trip.
                        </div>
                        <div class="mt-3">
                            <a asp-action="MyBookings" class="btn btn-secondary">Back to My Bookings</a>
                        </div>
                    }
                    else
                    {
                        <!-- Trip Info -->
                        <div class="mb-4">
                            <h5>Trip Details</h5>
                            <div class="card bg-light">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <strong>Route:</strong> @Model.StartCity → @Model.EndCity
                                        </div>
                                        <div class="col-md-6">
                                            <strong>Date:</strong> @Model.Departure.ToString("dd MMM yyyy, HH:mm")
                                        </div>
                                        <div class="col-12 mt-2">
                                            <strong>Driver:</strong> @Model.ReviewedUserName
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Review Form -->
                        <form asp-action="Review" method="post">
                            <input type="hidden" asp-for="BookingID" />
                            <input type="hidden" asp-for="RouteID" />
                            <input type="hidden" asp-for="ReviewedUserID" />
                            <input type="hidden" asp-for="ReviewedUserName" />
                            <input type="hidden" asp-for="StartCity" />
                            <input type="hidden" asp-for="EndCity" />
                            <input type="hidden" asp-for="Departure" />

                            <!-- Star Rating -->
                            <div class="mb-4">
                                <label class="form-label"><strong>How was your trip?</strong></label>
                                <div class="star-rating">
                                    <input type="radio" asp-for="Rating" value="5" id="star5" />
                                    <label for="star5" title="Excellent">★</label>
                                    
                                    <input type="radio" asp-for="Rating" value="4" id="star4" />
                                    <label for="star4" title="Very Good">★</label>
                                    
                                    <input type="radio" asp-for="Rating" value="3" id="star3" />
                                    <label for="star3" title="Good">★</label>
                                    
                                    <input type="radio" asp-for="Rating" value="2" id="star2" />
                                    <label for="star2" title="Fair">★</label>
                                    
                                    <input type="radio" asp-for="Rating" value="1" id="star1" />
                                    <label for="star1" title="Poor">★</label>
                                </div>
                                <span asp-validation-for="Rating" class="text-danger"></span>
                                <div class="form-text">Click on the stars to rate your experience (5 stars = Excellent)</div>
                            </div>

                            <!-- Comment -->
                            <div class="mb-4">
                                <label asp-for="Comment" class="form-label"><strong>Share your experience (optional)</strong></label>
                                <textarea asp-for="Comment" class="form-control" rows="4" 
                                          placeholder="Tell other passengers about your trip experience..."
                                          maxlength="250"></textarea>
                                <div class="form-text">Maximum 250 characters</div>
                                <span asp-validation-for="Comment" class="text-danger"></span>
                            </div>

                            <!-- Buttons -->
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-lg me-1" viewBox="0 0 16 16">
                                        <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                                    </svg>
                                    Submit Review
                                </button>
                                <a asp-action="MyBookings" class="btn btn-secondary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left me-1" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
                                    </svg>
                                    Back to My Bookings
                                </a>
                            </div>
                        </form>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .star-rating {
        display: flex;
        flex-direction: row-reverse;
        justify-content: flex-end;
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }

    .star-rating input {
        display: none;
    }

    .star-rating label {
        color: #ddd;
        cursor: pointer;
        margin-right: 0.1rem;
        transition: color 0.2s;
    }

    .star-rating label:hover,
    .star-rating label:hover ~ label {
        color: #ffc107;
    }

    .star-rating input:checked ~ label {
        color: #ffc107;
    }

    .star-rating input:checked + label:hover,
    .star-rating input:checked + label:hover ~ label,
    .star-rating input:checked ~ label:hover,
    .star-rating input:checked ~ label:hover ~ label,
    .star-rating label:hover ~ input:checked ~ label {
        color: #ffc107;
    }
</style>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
}